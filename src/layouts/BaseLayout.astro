---
import "../styles/global.css";

const path = Astro.url.pathname;
const base = import.meta.env.BASE_URL.endsWith("/")
  ? import.meta.env.BASE_URL
  : `${import.meta.env.BASE_URL}/`;
const withBase = (value = "") => {
  const normalized = value.replace(/^\/+/, "");
  return normalized ? `${base}${normalized}` : base;
};
const normalizePath = (value) => (value.endsWith("/") ? value : `${value}/`);
const homePath = withBase("");
const currentPath = normalizePath(path);
const siteBaseUrl = Astro.site ?? Astro.url;

const {
  title,
  description,
  ogImage = withBase("images/header-cat.jpg"),
  ogType = "website",
} = Astro.props;

const pageTitle = title ? `${title} | Leo` : "Leo";
const pageDescription = description ?? "Portfolio and technical notes by Leo";
const canonicalUrl = new URL(path, siteBaseUrl).toString();
const toAbsoluteUrl = (value) => {
  if (!value) return undefined;
  try {
    return new URL(value).toString();
  } catch {
    return new URL(value, siteBaseUrl).toString();
  }
};
const ogImageUrl = toAbsoluteUrl(ogImage);

const nav = [
  { href: homePath, label: "Home" },
  { href: withBase("about/"), label: "About" },
  { href: withBase("blog/"), label: "Blog" },
];
---

<html lang="ja">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>{pageTitle}</title>
    <meta name="description" content={pageDescription} />
    <link rel="canonical" href={canonicalUrl} />
    <meta property="og:title" content={pageTitle} />
    <meta property="og:description" content={pageDescription} />
    <meta property="og:type" content={ogType} />
    <meta property="og:url" content={canonicalUrl} />
    <meta property="og:site_name" content="Leo" />
    <meta property="og:locale" content="ja_JP" />
    {ogImageUrl && <meta property="og:image" content={ogImageUrl} />}
    {ogImageUrl && <meta property="og:image:alt" content={`${pageTitle} thumbnail`} />}
    <meta name="twitter:card" content="summary_large_image" />
    <meta name="twitter:title" content={pageTitle} />
    <meta name="twitter:description" content={pageDescription} />
    {ogImageUrl && <meta name="twitter:image" content={ogImageUrl} />}
    <link rel="icon" type="image/jpeg" href={withBase("images/header-cat.jpg")} />
    <link rel="shortcut icon" href={withBase("images/header-cat.jpg")} />
  </head>
  <body>
    <header class="site">
      <div class="container">
        <div class="nav">
          <a class="brand" href={homePath}>
            <img
              class="brand-avatar"
              src={withBase("images/header-cat.jpg")}
              alt="Home"
              width="40"
              height="40"
              loading="eager"
              decoding="async"
            />
          </a>
          <nav class="navlinks">
            {nav.map((item) => (
              <a
                href={item.href}
                aria-current={
                  currentPath === item.href ||
                  (item.href !== homePath && currentPath.startsWith(item.href))
                    ? "page"
                    : undefined
                }
              >
                {item.label}
              </a>
            ))}
          </nav>
        </div>
      </div>
    </header>

    <main class="container">
      <slot />
    </main>

    <footer>
      <div class="container">
        <div class="meta">
          Â© {new Date().getFullYear()} Leo(a.k.a Nyleon)
        </div>
      </div>
    </footer>
  </body>
</html>
